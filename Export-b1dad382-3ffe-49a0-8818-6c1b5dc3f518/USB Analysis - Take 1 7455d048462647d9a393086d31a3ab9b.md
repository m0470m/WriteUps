# USB Analysis - Take 1

The objective for this practical was to see what data I could find on a USB after performing a quick format, full format, and wipe. 

This is my first approach at the task, which had deviated from the initial objective a fair bit as I explored a different approach. While I'm keen to return to the original task (which plans are detailed within the methodology), overall, I'm happy with how much I've learned and how much I now know I don't know.

**Note:** The write up is pretty informal and a bit brain-dumpy. Bear with me!

# Methodology

I had taken a goal-focused approach to the task (which retrospectively may have caused me to deviate from the original, as the learning objectives didn't align). Basically:

**Populate a USB with content, and wipe it with two different methods. Analyse the device to see what remains.**

From that, I came up with some questions to help guide my actions: 

- Can I still access files after they've been deleted, but the device not wiped?
    - *Yes, trivially*
- Can I view the files after they have been wiped?
    - *If I used a recovery tool, or had somehow managed to recover the files, sure*
- Can I recover files after they have been wiped?
    - *Yes, but I'm not exactly sure how*
- Can I determine what method has been used to wipe the device?
    - *No idea - Further research needed, but I don't know if that data exists - Likely can be inferred*
- Can I determine when was the wipe performed?
    - *No idea - Further research needed to see if there's data specific to this, or if it could be inferred*

## Deviation

- Instead of performing the three wipes - quick format, full format, and a wipe - I deleted and quick formatted
- Didn't use photorec, or run it after each time I did something

### Method for Take 2

- Get a fresh USB, populate it with data and image
- Perform a quick format and observe
- Perform a full format and observe, noting any changes and data
- Wipe and observe - one or two passes(Can probably use *MiniTool* or possible HxD)

# Findings

## Overview

Overall, it was possible to recover files after both deleting files and performing a quick wipe. When deleting files, those files were still present within the file system, and could be easily recovered. It was possible to 'recover' files after performing a quick format using a tool *MiniTool*, however, due to licensing, those files were not retrieved. 

When a quick format was performed, these files were removed from within the allocated storage. By comparing the contents of the USB artifacts extracted with *FTK Imager,* and opened with *HxD,* it was possible to observe that there were changes to the hex values. 

## Process Notes

- Populated USB  with files

![USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled.png](USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled.png)

- Deleted files - Was prompted to permanently delete
- Created an image of the freshly wiped drive

![USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%201.png](USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%201.png)

- Loaded the image in FTK Imager, right away something interesting popped out - the "Tempo" directory and subdirectory was still listed

![USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%202.png](USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%202.png)

- All the files were still within the "root" folder too, with the expected sizes - Does this mean they were flagged for deletion but still existed?

![USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%203.png](USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%203.png)

- Could trivially recover the files with FTK with "Export Files"

![USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%204.png](USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%204.png)

- Files were still "in-tact" - Uncertain if anything was modified however, besides the file name (where "!" was prepended on some files"

![USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%205.png](USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%205.png)

*Could still view the media in the "!MG_0790.MOV"*

- Interesting things - "File Slack"
    - Need to look more into how filesystems partition data - From a basic understanding, file slack is there to fill a hard drive cluster (??big citation needed there) - To look into more
- Looking at the other artifacts in the system.
    - "[unallocated space]" has files with expected sizes - Assuming it's the free space

    ![USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%206.png](USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%206.png)

    - Noticed some files populated with content from the FTK hex preview, so extracted one to check it out it HxD, specifically "204806"
        - A cursory view looked like it was mostly garbage → To look into string extractors and other tools which handle binary - IDA might be worth revisiting. Decided not to dig too deep into the j̶̨̨̳͎̟̺̩̜̼̥͖͓̖͐͂͛͘͜u̸̥̤̇̈́n̵̺̞͓̜̗̰̙͒̀͆͌̏͑̊͊̑͊ķ̸͚͎̟̭̖͌̈́́̕ until I answer the main questions

![USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%207.png](USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%207.png)

- Extracted the content from NONAME [FAT32]
    - VBR - Volume Boot Record:
        - Had interesting strings including:
            - ex.MSDOS5.0
                - OEM Name in text (?)
            - NAME FAT32
            - Disk error. Press any key to restart
            - An operating system wasn't found. Try disconnecting any drives that don't contain an operating system.
    - FAT1 and FAT2
        - Have the same headers (?)
    - reserved sectors
        - Not entirely sure what it serves
- Extracted content from System Volume Information
    - WPSettings.dat
        - Not sure what the contents are, apparently a file generated by Storage Service (StorSvc) - Enables services for storage settings and external storage expansion
            - Is this something created by a windows OS when plugged into a computer? Possibly something to look into with a fresh USB and HWB
    - IndexerVolumeGuid - Assigns a unique GUID so windows knows which database to asociate with the drive
        - GUID assigned to device - identified as {839B6964-8121-4813-9A5C-1B1C00B44C96}
- Extracted info from Unpartitioned Space [basic disk]
    - MBR
        - Assuming it's similar to VBR, as in it tells the system how to handle it. Key things:
            - "Invalid partition table. Error loading operating system. Missing operating system"
- Decided to format the drive (after deletion) - Performed a Quick Format
    - Keen to see the difference between deleted files and formatted files -
    - Keen to also populate a USB, perform a quick format and see if there's a difference there too
- Imaged the device again

![USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%208.png](USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%208.png)

- Added image as evidence in FTK imager
- Initial observations show that the deleted folders and files were not present,

![USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%209.png](USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%209.png)

![USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%2010.png](USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%2010.png)

- Extracted and observed the artifacts again, this time comparing with those from 002_USB_E_DeletedFiles
    - NONAME [FAT32]
        - VBR

        ![USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%2011.png](USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%2011.png)

        - reserved sectors
        - FAT2
        - FAT1
    - System Volume Information
        - WPSettings.dat

        ![USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%2012.png](USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%2012.png)

        - IndexerVolumeGuid
            - Minor differences - Would be curious to see what the comparison with assembly calls means (if anything_
    - [unallocated space]
        - 204806
            - Most was new - Still looked like all garbage. Likely if I missed something, as I was only stepping through each comparison. Highlighting for all comparisons for differences may have made any similar content obvious
        - 025606
            - Files were identical - Got a prompt from HxD. Curious why this was identical, but 204806 was seemingly unique
    - Unpartitioned Space [basic disk]
        - MBR
            - Identical
- Now that I'd checked the differences, I tried to figure out what was going on and if I could recover information from the unallocated space
    - Mounted the device image using FTK (G:)

    ![USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%2013.png](USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%2013.png)

    - Used *MiniTool Partition Wizard* to try to recover data from the logical disk:

    ![USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%2014.png](USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%2014.png)

    - Limited to what I could observe from the free version of the tool (uncertain if filenames and associated metadata is preserved in unallocated space), but there were some interesting observations:
        - Not all information from the original selected files were present - For example, one jpeg from the original file set was missing
        - There were duplicate files

        ![USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%2015.png](USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%2015.png)

        - There were also files which weren't present in the original batch of data:

        ![USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%2016.png](USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%2016.png)

        ![USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%2017.png](USB%20Analysis%20-%20Take%201%207455d048462647d9a393086d31a3ab9b/Untitled%2017.png)

        - The size of the files were smaller than the original files
            - Uncertain if this means a loss in data, or something else

# Observations

Overall I feel there's some fundamental concepts I don't understand with file systems. However, the exercise was a good starting point to find what to look into, as detailed in the gaps in knowledge. I didn't have many issues with the tooling however, but should spend more care to look for more tools which may parse things a bit nicer, particularly when making comparisons or trying to find strings. 

Some other general observations:

- My naming conventions for evidence is rather inconsistent, and ways that I store evidence and label it reflects that. I can see myself encountering issues if I don't have some sort of standard for categorisation.
- There were two points where I had lost track of where I got up to, and couldn't back track as a result of not documenting the steps taken.
- I encountered a "fork in the road" with my approach that I didn't consider when planning the work to be performed. Retrospectively, a more ideal approach would be to:
    1. Image the USB with all content populated
    2. Mount that image, delete the files, create another image 
    3. Mount the original USB again, perform a format, and create an image  
    4. Analyse the two and compare as necessary

    This may have avoided any unknown changes which may occur when formatting a device after files have been deleted. The approach taken, while was illustrative to determine the difference on a high level, may introduce uncertainty.

- Could have also made a comparison in HxD by using the 'open image' functionality and similar - more of a top-down approach
- Overall, I didn't pay attention to details which are likely to contain important information, such as file size, number of files etc. Instead, I took more of a 'high-level observation' approach. While I learned a lot about the device, I feel like there was much that was missed.
- My approach may have been more 'what can I do' instead of 'what happened?'
- Next time I'll buy a USB and image it with write block (bonus if I can find a HWB for USB)
- I couldn't really determine if the "files were still there" after performing a quick format, as I didn't know how the file system works, i only could speculate given there were changes in the hex values

## Lessons learned

- Became more comfortable with FTK Imager, particularly imaging devices, mounting them, extracting information, and using the evidence tree (tree?).
- Gained a better, while still basic, level of file systems especially with allocated and unallocated space
- Learned how to use HxD for the first time, will keep practicing with it to understand the nuances
- Practical analysis like this has been incredibly useful for learning - Starting to change my approach from *"Must have a clear goal"* to *"What does this thing look like and how does it work?"*
- While a useful exercise, I missed the mark on the original objectives, which will definitely cause trouble if in the future if I'm fully aware of what's to do.

## Gaps in Knowledge

***Areas I struggled with a bit, or have only scratched the surface on.*** 

- File allocation tables and everything to do about them
- What are unallocated and allocated space?
    - What is relevant about them, and what do they hold?
- How is data populated or represented in a file system, and how is it removed?
- How does the USB interact with a system?
    - What purpose do the headers serve?
- What exactly occurs when data is written to a drive, or deleted?
- What interesting information can a USB give?

***Questions I'll likely answer myself with some study***

- What happens when a file is deleted?
- Why can I still recover "deleted" files? Why are files still there?
- What exactly is file slack?
- How do I know what garbage binary looks like?
    - Are there better ways to parse the information?
- What do all the artifacts mean?
    - What is relevant about each?
- What relevance does a GUID have?
    - How can I tell if it's static, or dynamically set?
- How does data recovery work?
- What is unique about a FAT32 system?
- What were the changes made to the hex values and what does it mean?

***General questions with questionable answers***

- How do I keep on track with the goal?
    - More importantly, how do I make sure I interpret the goal correctly to begin with?
- What ways can I improve my note taking and presentation of information?